
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>5. Support for Persistent PV State &#8212; EPICS Device  documentation</title>
    <link rel="stylesheet" href="_static/classic.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/language_data.js"></script>
    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="6. Support for PV Logging" href="pvlogging.html" />
    <link rel="prev" title="4. Database Builder Support" href="builder.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pvlogging.html" title="6. Support for PV Logging"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="builder.html" title="4. Database Builder Support"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">EPICS Device  documentation</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="support-for-persistent-pv-state">
<h1><span class="section-number">5. </span>Support for Persistent PV State<a class="headerlink" href="#support-for-persistent-pv-state" title="Permalink to this headline">¶</a></h1>
<p>This EPICS Device module provides a mechanism for persistent PV state which is
quite different from the mechanism provided by autosave/restore.  If
autosave/restore is used then this functionality can be ignored, and no PVs
should be marked as persistent internally.</p>
<p>The functionality described here is defined in the header file
<code class="docutils literal notranslate"><span class="pre">persistence.h</span></code>.</p>
<p>The mechanism here works by saving a single file containing the persistent state
of each PV marked for persistence.  Note that only <code class="docutils literal notranslate"><span class="pre">epics_device</span></code> PVs can be
marked as persistent, and the persistence marking is performed at the time the
PVs are published to the device by the IOC.</p>
<p>The following functions provide the persistence interface.</p>
<dl class="function">
<dt id="c.load_persistent_state">
<a class="reference internal" href="error.html#c.error__t" title="error__t">error__t</a> <code class="sig-name descname">load_persistent_state</code><span class="sig-paren">(</span>const char<em> *file_name</em>, int<em> save_interval</em>, <a class="reference internal" href="external.html#c.bool" title="bool">bool</a><em> check_parse</em><span class="sig-paren">)</span><a class="headerlink" href="#c.load_persistent_state" title="Permalink to this definition">¶</a></dt>
<dd><p>This should be called once after publishing all PVs to EPICS device but
before calling <a class="reference internal" href="external.html#c.iocInit" title="iocInit"><code class="xref c c-func docutils literal notranslate"><span class="pre">iocInit()</span></code></a>.  The given <cite>file_name</cite> will be loaded, if
present, to determine initial values for all PVs marked for persistence.
After this point updates to PVs will be written back to the state file at
the interval determined by <cite>save_interval</cite>, in seconds.</p>
<p>If <cite>check_parse</cite> is <code class="docutils literal notranslate"><span class="pre">false</span></code> then this function will return success even if
there are parsing errors while loading the persistence file.</p>
<p>This function can be called from the IOC shell, but in this case the return
code is lost.</p>
</dd></dl>

<dl class="function">
<dt id="c.update_persistent_state">
<a class="reference internal" href="error.html#c.error__t" title="error__t">error__t</a> <code class="sig-name descname">update_persistent_state</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.update_persistent_state" title="Permalink to this definition">¶</a></dt>
<dd><p>This can be called to force the state file to be written if any persistent
PVs have changed their state.</p>
</dd></dl>

<dl class="function">
<dt id="c.terminate_persistent_state">
void <code class="sig-name descname">terminate_persistent_state</code><span class="sig-paren">(</span>void<span class="sig-paren">)</span><a class="headerlink" href="#c.terminate_persistent_state" title="Permalink to this definition">¶</a></dt>
<dd><p>This can be called during IOC shutdown to force an orderly termination of
the persistence state and ensure that the state file is up to date.</p>
</dd></dl>

</section>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="builder.html"
                        title="previous chapter"><span class="section-number">4. </span>Database Builder Support</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="pvlogging.html"
                        title="next chapter"><span class="section-number">6. </span>Support for PV Logging</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="_sources/persistence.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="pvlogging.html" title="6. Support for PV Logging"
             >next</a> |</li>
        <li class="right" >
          <a href="builder.html" title="4. Database Builder Support"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">EPICS Device  documentation</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2015, Michael Abbott.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.3.1.
    </div>
  </body>
</html>